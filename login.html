<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login â€” BTech Vault</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
  <script src="firebase-config.js"></script>
</head>
<body>

<div class="login-page">
  <div class="login-card">
    <span class="logo-big">BTech<span style="color:var(--text2); font-weight:400;">Vault</span></span>
    <p class="tagline">// For supply. For backlogs. For success.</p>

    <div style="background:var(--bg3); border:1px solid var(--border); border-radius:10px; padding:1.25rem; margin-bottom:1.5rem;">
      <p style="font-size:0.875rem; color:var(--text2); margin-bottom:0.75rem;">ðŸŽ“ <strong style="color:var(--text);">Made for B.Tech Students</strong> â€” Share & access free study PDFs</p>
      <div style="display:flex; flex-direction:column; gap:0.4rem;">
        <div style="font-size:0.8rem; color:var(--text3);">âœ… Browse PDFs for free (no login needed)</div>
        <div style="font-size:0.8rem; color:var(--text3);">âœ… Login to save PDFs to your account</div>
        <div style="font-size:0.8rem; color:var(--text3);">âœ… Login to upload PDFs</div>
        <div style="font-size:0.8rem; color:var(--success);">ðŸ”’ Your saved PDFs are private â€” no one else can see them</div>
      </div>
    </div>

    <button class="btn-google" onclick="handleGoogleLogin()" id="loginBtn">
      <img src="https://www.google.com/favicon.ico" alt="Google"/>
      Continue with Google
    </button>

    <div id="errorMsg" style="display:none; background:rgba(248,113,113,0.1); border:1px solid var(--danger); border-radius:8px; padding:0.75rem; margin-top:1rem; font-size:0.85rem; color:var(--danger);"></div>

    <div class="login-divider">or just browse</div>

    <a href="index.html" class="btn btn-outline" style="width:100%; justify-content:center;">
      Browse PDFs (No Login)
    </a>

    <p style="text-align:center; font-size:0.75rem; color:var(--text3); margin-top:1.5rem; font-family:'DM Mono',monospace;">
      Nee data safe ga untundi. We don't sell anything.
    </p>
  </div>
</div>

<script>
auth.onAuthStateChanged((user) => {
  if (user) {
    // Already logged in, redirect
    const redirect = new URLSearchParams(window.location.search).get('redirect') || 'index.html';
    window.location.href = redirect;
  }
});

async function handleGoogleLogin() {
  const btn = document.getElementById('loginBtn');
  const errDiv = document.getElementById('errorMsg');

  btn.disabled = true;
  btn.innerHTML = `<div class="spinner" style="border:2px solid #ccc; border-top-color:#333;"></div> Logging in...`;
  errDiv.style.display = 'none';

  try {
    await signInWithGoogle();
    window.location.href = 'index.html';
  } catch (err) {
    errDiv.style.display = 'block';
    errDiv.textContent = 'Login error: ' + (err.message || 'Malli try cheyyandi');
    btn.disabled = false;
    btn.innerHTML = `<img src="https://www.google.com/favicon.ico" alt="Google"/> Continue with Google`;
  }
}
</script>
</body>
</html>
